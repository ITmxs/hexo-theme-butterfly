---
date: 2021-10-09 00:00:00
title: 如何使用 CloudFlare 缓解针对您网站的 DDoS 攻击
tags: DDoS
categories: 
    - DDoS
    - 使用CloudFlare缓解
cover: /image/bk_13/cover.jpg
top_img: /image/bk_13/top_img.jpg
abbrlink: e346
---

## 介绍


CloudFlare 是一家通过充当网站的反向代理来提供内容交付网络 (CDN) 和分布式 DNS 服务的公司。CloudFlare 的免费和付费服务可用于以多种方式提高网站的安全性、速度和可用性。在本教程中，我们将向您展示如何使用 CloudFlare 的免费层服务通过启用“我处于攻击模式”来保护您的 Web 服务器免受持续的基于 HTTP 的 DDoS 攻击。这种安全模式可以通过在将连接传递到您的 Web 服务器之前呈现一个插页式页面来验证连接的合法性来减轻 DDoS 攻击。


## 先决条件


本教程假设您具备以下条件：

1.一个网络服务器

2.指向您的 Web 服务器的注册域

3.访问颁发域的域注册商的控制面板

在继续之前，您还必须注册 CloudFlare 帐户。请注意，本教程将需要使用 CloudFlare 的名称服务器。



## 配置您的域以使用 CloudFlare


在使用 CloudFlare 的任何功能之前，您必须将域配置为使用 CloudFlare 的 DNS。

如果您还没有这样做，请登录 CloudFlare。


## 添加网站并扫描 DNS 记录


登录后，您将进入CloudFlare 入门 页面。在这里，您必须将您的网站添加到 CloudFlare：

![](/image/bk_13/1a.jpg)


输入要与 CloudFlare 一起使用的域名，然后单击开始扫描 按钮。你应该被带到一个看起来像这样的页面：

![](/image/bk_13/1b.jpg)


这大约需要一分钟。完成后，单击“继续” 按钮。

下一页显示 DNS 记录扫描的结果。确保您现有的所有 DNS 记录都存在，因为 CloudFlare 将使用这些记录来解析对您的域的请求。在我们的示例中，我们用作 cockroach.nyc域：

![](/image/bk_13/1c.jpg)



请注意，对于指向您的 Web 服务器的 A 和 CNAME 记录，“状态” 列应该有一个橙色的云，箭头穿过它。这表明流量将在到达您的服务器之前流经 CloudFlare 的反向代理。

接下来，选择您的 CloudFlare 计划。在本教程中，我们将选择免费计划 选项。如果您因为想要额外的 CloudFlare 功能而想为不同的计划付费，请随时这样做：

![](/image/bk_13/1d.jpg)


## 更改您的域名服务器
下一页将显示您域的当前名称服务器及其应更改为的表。其中两个应更改为 CloudFlare 名称服务器，其余条目应删除。如果您的域正在使用 DigitalOcean 名称服务器，则该页面的外观示例如下：


![](/image/bk_13/1e.jpg)



要更改您域的名称服务器，请登录您的域注册商控制面板并进行 CloudFlare 提供的 DNS 更改。例如，如果您通过 GoDaddy 或 NameCheap 等注册商购买了域，则需要登录相应注册商的控制面板并在那里进行更改。

该过程因您的特定域注册商而异。如果您不知道如何执行此操作，它类似于如何从公共域注册商指向 DigitalOcean 名称服务器中描述的过程，不同之处在于您将使用 CloudFlare 名称服务器而不是 DigitalOcean 的名称服务器。

在示例中，域使用 DigitalOcean 的域名服务器，我们需要更新它以使用 CloudFlare 的 DNS。该域是通过 NameCheap 注册的，因此我们应该在那里更新名称服务器。

完成名称服务器的更改后，单击“继续” 按钮。名称服务器的切换最多可能需要 24 小时，但通常只需要几分钟。

## 等待名称服务器更新
由于更新名称服务器需要花费不可预测的时间，因此您很可能会在接下来看到此页面：

![](/image/bk_13/1f.jpg)

服务器的挂起 状态表示的CloudFlare正在等待的域名服务器，以更新它规定（例如的那些 olga.ns.cloudflare.com和 rob.ns.cloudflare.com）。如果您更改了域的名称服务器，您所要做的就是等待，稍后再回来查看是否处于活动 状态。如果您单击重新检查名称服务器 按钮或导航到 CloudFlare 仪表板，它将检查名称服务器是否已更新。

## CloudFlare 处于活动状态

域名服务器更新后，您的域将使用 CloudFlare 的 DNS，您将看到它处于活动 状态，如下所示：

![](/image/bk_13/1g.jpg)


这意味着 CloudFlare 充当您网站的反向代理，您可以访问您注册的定价层可用的任何功能。如果您使用的是免费 层，就像我们在本教程中一样，您将可以访问一些可以提高站点安全性、速度和可用性的功能。我们不会涵盖本教程中的所有功能，因为我们专注于减轻持续的 DDoS 攻击，但它们包括 CDN、SSL、静态内容缓存、防火墙（在流量到达您的服务器之前）和流量分析工具。

另请注意设置摘要 ，您的域正下方将显示您网站的当前安全级别（默认为中等）和一些其他信息。

在继续之前，为了充分利用 CloudFlare，您需要遵循本指南：所有 CloudFlare 用户推荐的第一步。这对于确保 CloudFlare 将允许来自您想要允许的服务的合法连接很重要，并且您的 Web 服务器日志将显示原始访问者 IP 地址（而不是 CloudFlare 的反向代理 IP 地址）。

设置完成后，让我们看看CloudFlare 防火墙中的I'm Under Attack Mode 设置。


## 我处于攻击模式
默认情况下，CloudFlare 的防火墙安全设置为Medium 。这通过在允许他们继续访问您的网站之前向他们展示挑战页面来为被评为中等威胁的访问者提供一些保护。但是，如果您的站点是 DDoS 攻击的目标，这可能不足以让您的站点正常运行。在这种情况下，I'm Under Attack 模式 可能适合您。

如果您启用此模式，您网站的任何访问者都会看到一个间隙页面，该页面会执行一些浏览器检查并在将访问者传递到您的服务器之前延迟大约 5 秒钟。它看起来像这样；

![](/image/bk_13/1h.jpg)


安全设置将立即切换到我 受到攻击状态。现在，您网站的任何访问者都将看到上述 CloudFlare 插页式页面。


## 如何禁用我处于攻击模式

由于I'm Under Attack 模式 只能在 DDoS 紧急情况下使用，如果您没有受到攻击，您应该禁用它。为此，请转到 CloudFlare 概览页面，然后单击禁用 按钮：

![](/image/bk_13/1i.jpg)

然后选择您要切换到的安全级别。默认且通常推荐的模式是Medium ：

![](/image/bk_13/1j.jpg)

您的站点应该恢复到活动 状态，并且 DDoS 保护页面将被禁用。


## 结论

现在您的网站正在使用 CloudFlare，您有另一个工具可以轻松保护它免受基于 HTTP 的 DDoS 攻击。CloudFlare 还提供了您可能有兴趣设置的各种其他工具，例如免费的 SSL 证书。因此，建议您探索这些选项并查看对您有用的内容。